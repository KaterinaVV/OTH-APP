This project contains the code for the backend of the OTH App.

# Getting Started
For instructions and documentation on how to get started contributing to this project we suggest reading our internal [Wiki](https://gitlab.oth-regensburg.de/IM/labor_oth-app/oth-app-server/-/wikis/home) 
and [API documentation](https://im-vm-031.othr.de).

# Basic Configuration
There are the profiles `default`, `staging` and `dev`. `default` is always applied.
For local development the profile `dev` is recommended, as all services but exchange are disabled.
To start the application locally you also have to provide passwords for the services you want to use.
You can find those passwords on the VM or you can ask colleagues for them.

For the exchange service you can also use the alternative way of authenticating by filling the `RZ_USER` and 
`RZ_PASSWORD` environment variables with your rz-credentials (`abc12345`)

# Code Generation
* `resources/jooq/generated/state/information_schema.xml` contains a snapshot of the database state, which is used to generate the Database Entities.
* `build/generated-src/jooq/main` contains the Database Entities generated by JOOQ via the Gradle plugin `nu.studer.jooq` and the corresponding Gradle task `generateJooq`. Configuration can be found in `gradle/scripts/jooq.gradle`
* `build/generated-src/openapi` contains the API Interfaces for Spring REST controllors and the REST API model DTOs. These are generated by the Gradle plugin `org.openapi.generator` and the gradle task `openApiGenerate`.

# Database
We use the PostgreSQL database.
You have to start one locally so that the server can use it via the jdbc string `jdbc:postgresql://localhost:5432/othapp` (user: `sa`, pass: `password`).

For that run `docker compose up` / `docker-compose up` (version 1.28.0 or later), or `docker-compose --profile debug up` if you want the pgadmin frontend on <http://localhost:5050>.

## Migration
We use the intermediate `information_schema.xml` as a way to still be able to generate db entities without a running database.
This means that after every schema change we have to update the xml file and commit it.
For this start the database (`docker-compose up`) and run `gradlew generateXmlJooq`
